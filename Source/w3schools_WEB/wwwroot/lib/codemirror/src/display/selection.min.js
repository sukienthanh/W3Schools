/**
 * Minified by jsDelivr using Terser v5.7.1.
 * Original file: /npm/codemirror@5.63.3/src/display/selection.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{Pos}from"../line/pos.js";import{visualLine}from"../line/spans.js";import{getLine}from"../line/utils_line.js";import{charCoords,cursorCoords,displayWidth,paddingH,wrappedLineExtentChar}from"../measurement/position_measurement.js";import{getOrder,iterateBidiSections}from"../util/bidi.js";import{elt}from"../util/dom.js";import{onBlur}from"./focus.js";export function updateSelection(t){t.display.input.showSelection(t.display.input.prepareSelection())}export function prepareSelection(t,e=!0){let o=t.doc,r={},i=r.cursors=document.createDocumentFragment(),l=r.selection=document.createDocumentFragment();for(let r=0;r<o.sel.ranges.length;r++){if(!e&&r==o.sel.primIndex)continue;let n=o.sel.ranges[r];if(n.from().line>=t.display.viewTo||n.to().line<t.display.viewFrom)continue;let s=n.empty();(s||t.options.showCursorWhenSelecting)&&drawSelectionCursor(t,n.head,i),s||drawSelectionRange(t,n,l)}return r}export function drawSelectionCursor(t,e,o){let r=cursorCoords(t,e,"div",null,null,!t.options.singleCursorHeightPerLine),i=o.appendChild(elt("div"," ","CodeMirror-cursor"));if(i.style.left=r.left+"px",i.style.top=r.top+"px",i.style.height=Math.max(0,r.bottom-r.top)*t.options.cursorHeight+"px",/\bcm-fat-cursor\b/.test(t.getWrapperElement().className)){let o=charCoords(t,e,"div",null,null);o.right-o.left>0&&(i.style.width=o.right-o.left+"px")}if(r.other){let t=o.appendChild(elt("div"," ","CodeMirror-cursor CodeMirror-secondarycursor"));t.style.display="",t.style.left=r.other.left+"px",t.style.top=r.other.top+"px",t.style.height=.85*(r.other.bottom-r.other.top)+"px"}}function cmpCoords(t,e){return t.top-e.top||t.left-e.left}function drawSelectionRange(t,e,o){let r=t.display,i=t.doc,l=document.createDocumentFragment(),n=paddingH(t.display),s=n.left,p=Math.max(r.sizerWidth,displayWidth(t)-r.sizer.offsetLeft)-n.right,d="ltr"==i.direction;function a(t,e,o,r){e<0&&(e=0),e=Math.round(e),r=Math.round(r),l.appendChild(elt("div",null,"CodeMirror-selected",`position: absolute; left: ${t}px;\n                             top: ${e}px; width: ${null==o?p-t:o}px;\n                             height: ${r-e}px`))}function u(e,o,r){let l,n,u=getLine(i,e),c=u.text.length;function h(o,r){return charCoords(t,Pos(e,o),"div",u,r)}function f(e,o,r){let i=wrappedLineExtentChar(t,u,null,e),l="ltr"==o==("after"==r)?"left":"right";return h("after"==r?i.begin:i.end-(/\s/.test(u.text.charAt(i.end-1))?2:1),l)[l]}let m=getOrder(u,i.direction);return iterateBidiSections(m,o||0,null==r?c:r,((t,e,i,u)=>{let g="ltr"==i,y=h(t,g?"left":"right"),b=h(e-1,g?"right":"left"),C=null==o&&0==t,x=null==r&&e==c,v=0==u,w=!m||u==m.length-1;if(b.top-y.top<=3){let t=(d?x:C)&&w,e=(d?C:x)&&v?s:(g?y:b).left,o=t?p:(g?b:y).right;a(e,y.top,o-e,y.bottom)}else{let o,r,l,n;g?(o=d&&C&&v?s:y.left,r=d?p:f(t,i,"before"),l=d?s:f(e,i,"after"),n=d&&x&&w?p:b.right):(o=d?f(t,i,"before"):s,r=!d&&C&&v?p:y.right,l=!d&&x&&w?s:b.left,n=d?f(e,i,"after"):p),a(o,y.top,r-o,y.bottom),y.bottom<b.top&&a(s,y.bottom,null,b.top),a(l,b.top,n-l,b.bottom)}(!l||cmpCoords(y,l)<0)&&(l=y),cmpCoords(b,l)<0&&(l=b),(!n||cmpCoords(y,n)<0)&&(n=y),cmpCoords(b,n)<0&&(n=b)})),{start:l,end:n}}let c=e.from(),h=e.to();if(c.line==h.line)u(c.line,c.ch,h.ch);else{let t=getLine(i,c.line),e=getLine(i,h.line),o=visualLine(t)==visualLine(e),r=u(c.line,c.ch,o?t.text.length+1:null).end,l=u(h.line,o?0:null,h.ch).start;o&&(r.top<l.top-2?(a(r.right,r.top,null,r.bottom),a(s,l.top,l.left,l.bottom)):a(r.right,r.top,l.left-r.right,r.bottom)),r.bottom<l.top&&a(s,r.bottom,null,l.top)}o.appendChild(l)}export function restartBlink(t){if(!t.state.focused)return;let e=t.display;clearInterval(e.blinker);let o=!0;e.cursorDiv.style.visibility="",t.options.cursorBlinkRate>0?e.blinker=setInterval((()=>{t.hasFocus()||onBlur(t),e.cursorDiv.style.visibility=(o=!o)?"":"hidden"}),t.options.cursorBlinkRate):t.options.cursorBlinkRate<0&&(e.cursorDiv.style.visibility="hidden")}
//# sourceMappingURL=/sm/882d1ae967d3586dfad06a6eb65fdb2fe50ba670ce6b6a56e7d3dcef403231ee.map